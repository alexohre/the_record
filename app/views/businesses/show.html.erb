
<% if @business.members.exists?(user_id: current_user.id, roles: 'admin') %>
  <h3>Invite staff</h3>
  <%= form_with(model: [@business, User.new], url: business_invite_path(@business), class: "row g-2 align-items-center") do |f| %>
    <div class="col-sm-3 mb-2">
      <%= f.email_field :email, class: 'form-control', placeholder: "Email Address" %>
    </div>
    <div class="col-sm-1 mb-2">
      <%= f.select :roles, options_for_select(Member.roles.keys), {}, class: 'form-control form-select' %>
    </div>
    <div class="col-sm-2 mb-2">
      <%= f.submit "Send invitation", class: "btn btn-primary" %>
    </div>
  <% end %>

<% end %>




<br><br>


<div class="row">
  <div class="col-md-6">
    <div class="card">
      <div class="card-body">
        <h3 class="card-title"><strong><%= @business.name %></strong> </h3>
        <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
         <h5><strong>Users</strong></h5>
         <% @business.members.each do |member| %>
          <% if member.user.invitation_token.present? && member.user.invitation_accepted_at.nil? %>
            <p><%= member.user.email %> - <span class="badge bg-primary"> <%= member.roles.capitalize %> </span> ~ <span class="badge bg-warning"> Pending </span> 
            <% if @business.members.exists?(user_id: current_user.id, roles: "admin") %>
             <%= link_to "Resend invitation", business_resend_invitation_path(@business, member.id), class: "ms-2 ", data: {turbo_method: :post} %> 
             <% end %>
             </p>
          <% else %>
          <p><%= member.user.email %> - <span class="badge bg-primary"> <%= member.roles.capitalize %></span></p>
          <% end %>
         <% end %>

         <% if @business.members.exists?(user_id: current_user.id, roles: 'admin') %>
          <%= link_to "Edit business", edit_business_path(@business), class: "btn btn-success" %>
          <%= link_to "Back", businesses_path, class: "btn btn-secondary" %>
          <%= link_to "Delete", @business, class: "btn btn-danger", data: {turbo_method: :delete, turbo_confirm: "Are you sure! #{@business.name} will be deleted"} %>
          <% else %>
          <%= link_to "Back", businesses_path, class: "btn btn-secondary" %>
         <% end %>
         
      </div>
    </div>
  </div>
</div>
