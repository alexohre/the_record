
<% if @business.members.exists?(user_id: current_user.id, roles: 'admin') %>
  <h3>Invite staff</h3>
  <%= form_with(model: [@business, User.new], url: business_invite_path(@business), class: "row g-2 align-items-center") do |f| %>
    <div class="col-sm-3 mb-2">
      <%= f.email_field :email, class: 'form-control', placeholder: "Email Address" %>
    </div>
    <div class="col-sm-1 mb-2">
      <%= f.select :roles, options_for_select(Member.roles.keys), {}, class: 'form-control form-select' %>
    </div>
    <div class="col-sm-2 mb-2">
      <%= f.submit "Send invitation", class: "btn btn-primary" %>
    </div>
  <% end %>

<% end %>




<br><br>


<div class="row">
  <div class="col-md-6">
    <div class="card">
      <div class="card-body">
        <h3 class="card-title"><strong><%= @business.name %></strong> </h3>
        <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
         <h5><strong>Users</strong></h5>
         <% @business.members.includes(:user).each do |member| %>
          <% if member.user.invitation_token.present? && member.user.invitation_accepted_at.nil? %>
            <div class="d-flex align-items-start mb-3">
              <%= member.user.email %> - <span class="badge bg-primary ms-2 me-2"> <%= member.roles.capitalize %> </span> ~ <span class="badge bg-info ms-2 me-2"> Pending </span> 
                <% if @business.members.exists?(user_id: current_user.id, roles: "admin") %>
                  <div class="dropdown">
                    <a class=" " href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
                        <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                      </svg>
                    </a>

                    <ul class="dropdown-menu">
                        <%= link_to "Resend invitation", business_resend_invitation_path(@business, member.id), class: "dropdown-item text-primary", data: {turbo_method: :post} %> 
                        <%= link_to "Remove #{member.user.email}", business_remove_member_path(@business, member.id, email: member.user.email), class: "dropdown-item text-danger", data: {turbo_method: :delete, turbo_confirm: "Are you sure you want to remove #{member.user.email}?" } %>
                    </ul>
                  </div>
              <% end %>
            </div>

          <% else %>
          <div class="d-flex align-items-start mb-3">
            <%= member.user.email %> - <span class="badge bg-primary ms-2 me-1"> <%= member.roles.capitalize %></span>
            <% if @business.members.exists?(user_id: current_user.id, roles: "admin") %>
                <% if member.user != current_user %>
                  <div class="dropdown">
                    <a class=" " href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
                        <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                      </svg>
                    </a>

                    <ul class="dropdown-menu">
                        <%= link_to "Block #{member.user.email}", business_resend_invitation_path(@business, member.id), class: "dropdown-item text-warning", data: {turbo_method: :post} %> 
                        <%= link_to "Remove #{member.user.email}", business_remove_member_path(@business, member.id, email: member.user.email), class: "dropdown-item text-danger", data: {turbo_method: :delete, turbo_confirm: "Are you sure you want to remove #{member.user.email}?" } %>
                    </ul>
                  </div>
                <% end %>
              <% end %>
          </div>
          <% end %>
         <% end %>

<br>
<br>
         <% if @business.members.exists?(user_id: current_user.id, roles: 'admin') %>
          <%= link_to "Edit business", edit_business_path(@business), class: "btn btn-success" %>
          <%= link_to "Back", businesses_path, class: "btn btn-secondary" %>
          <%= link_to "Delete", @business, class: "btn btn-danger", data: {turbo_method: :delete, turbo_confirm: "Are you sure! #{@business.name} will be deleted"} %>
          <% else %>
          <%= link_to "Back", businesses_path, class: "btn btn-secondary" %>
         <% end %>
         
      </div>
    </div>
  </div>
</div>
